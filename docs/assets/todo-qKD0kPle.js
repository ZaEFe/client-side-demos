import"./modulepreload-polyfill-B5Qt9EMX.js";import{c as R,j as o,r as m}from"./index-ByYvoH3u.js";const I=(t,e)=>e.some(n=>t instanceof n);let A,P;function F(){return A||(A=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function O(){return P||(P=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const E=new WeakMap,g=new WeakMap,j=new WeakMap;function W(t){const e=new Promise((n,r)=>{const c=()=>{t.removeEventListener("success",a),t.removeEventListener("error",s)},a=()=>{n(x(t.result)),c()},s=()=>{r(t.error),c()};t.addEventListener("success",a),t.addEventListener("error",s)});return j.set(e,t),e}function N(t){if(E.has(t))return;const e=new Promise((n,r)=>{const c=()=>{t.removeEventListener("complete",a),t.removeEventListener("error",s),t.removeEventListener("abort",s)},a=()=>{n(),c()},s=()=>{r(t.error||new DOMException("AbortError","AbortError")),c()};t.addEventListener("complete",a),t.addEventListener("error",s),t.addEventListener("abort",s)});E.set(t,e)}let B={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return E.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return x(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function L(t){B=t(B)}function K(t){return O().includes(t)?function(...e){return t.apply(S(this),e),x(this.request)}:function(...e){return x(t.apply(S(this),e))}}function U(t){return typeof t=="function"?K(t):(t instanceof IDBTransaction&&N(t),I(t,F())?new Proxy(t,B):t)}function x(t){if(t instanceof IDBRequest)return W(t);if(g.has(t))return g.get(t);const e=U(t);return e!==t&&(g.set(t,e),j.set(e,t)),e}const S=t=>j.get(t);function $(t,e,{blocked:n,upgrade:r,blocking:c,terminated:a}={}){const s=indexedDB.open(t,e),l=x(s);return r&&s.addEventListener("upgradeneeded",i=>{r(x(s.result),i.oldVersion,i.newVersion,x(s.transaction),i)}),n&&s.addEventListener("blocked",i=>n(i.oldVersion,i.newVersion,i)),l.then(i=>{a&&i.addEventListener("close",()=>a()),c&&i.addEventListener("versionchange",u=>c(u.oldVersion,u.newVersion,u))}).catch(()=>{}),l}const Z=["get","getKey","getAll","getAllKeys","count"],_=["put","add","delete","clear"],D=new Map;function M(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(D.get(e))return D.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,c=_.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(c||Z.includes(n)))return;const a=async function(s,...l){const i=this.transaction(s,c?"readwrite":"readonly");let u=i.store;return r&&(u=u.index(l.shift())),(await Promise.all([u[n](...l),c&&i.done]))[0]};return D.set(e,a),a}L(t=>({...t,get:(e,n,r)=>M(e,n)||t.get(e,n,r),has:(e,n)=>!!M(e,n)||t.has(e,n)}));const z=["continue","continuePrimaryKey","advance"],T={},C=new WeakMap,k=new WeakMap,G={get(t,e){if(!z.includes(e))return t[e];let n=T[e];return n||(n=T[e]=function(...r){C.set(this,k.get(this)[e](...r))}),n}};async function*H(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;e=e;const n=new Proxy(e,G);for(k.set(n,e),j.set(n,S(e));e;)yield n,e=await(C.get(n)||e.continue()),C.delete(n)}function v(t,e){return e===Symbol.asyncIterator&&I(t,[IDBIndex,IDBObjectStore,IDBCursor])||e==="iterate"&&I(t,[IDBIndex,IDBObjectStore])}L(t=>({...t,get(e,n,r){return v(e,n)?H:t.get(e,n,r)},has(e,n){return v(e,n)||t.has(e,n)}}));async function J(t){await t.createObjectStore("todos",{keyPath:"id",autoIncrement:!0})}async function Q(){return await $("to-do-app-db",1,{upgrade:J})}const p=Q(),h={async add(t){const n=(await p).transaction("todos","readwrite");await n.objectStore("todos").add(t),await n.done},async getAll(){return(await p).transaction("todos","readonly").objectStore("todos").getAll()},async remove(t){const n=(await p).transaction("todos","readwrite");await n.objectStore("todos").delete(t),await n.done},async update(t){const n=(await p).transaction("todos","readwrite");await n.objectStore("todos").put(t),await n.done},async clear(){const e=(await p).transaction("todos","readwrite");e.objectStore("todos").clear(),await e.done}};function X(){const[t,e]=m.useState([]),n=m.useRef(null),[r,c]=m.useState("No record updates");m.useEffect(()=>{h.getAll().then(e)},[]);function a(d){d.preventDefault();const f={id:Date.now(),text:new FormData(d.target).get("todo-text").trim()};h.add(f).then(h.getAll).then(b=>{e(b),b.find(w=>w.id===f.id&&w.text===f.text)&&u("Added a to do item")})}const s=d=>()=>{h.remove(d.id).then(h.getAll).then(f=>{e(f),f.find(y=>y.id===d.id&&y.text===d.text)||u("Removed a to do item")})},l=d=>()=>{h.update(d).then(h.getAll).then(e)},i=()=>h.clear().then(h.getAll).then(d=>{e(d),d.length===0&&u("Cleared all to do items")});function u(d){const f=new Date().toLocaleString();c(d+" at "+f)}return o.jsxs(o.Fragment,{children:[o.jsxs("header",{children:[o.jsx("img",{id:"logo",src:"/client-side-demos/todo.svg",alt:"Black check mark on Cyan"}),o.jsx("h1",{children:"To Do App"})]}),o.jsxs("main",{children:[o.jsx("p",{role:"status",ref:n,tabIndex:-1,children:r}),o.jsx(V,{onSubmit:a,inputName:"todo-text",buttonText:"Add"}),o.jsx("button",{onClick:i,children:"Clear All To Do Items"}),o.jsxs("article",{children:[o.jsx("h2",{children:"To Do List"}),o.jsx("ul",{children:t.map(d=>o.jsx(Y,{todo:d,todoRemover:s,todoUpdater:l},d.id))})]})]}),o.jsx("footer",{children:"Created by Zachary"})]})}function Y({todo:t,todoRemover:e,todoUpdater:n}){const r=m.useRef(null),{id:c,text:a}=t,[s,l]=m.useState(!1),i="updater-todo-text",u="Update",d=a,f=a;m.useEffect(()=>{s&&r.current&&r.current.focus()},[s]);function b(w){w.preventDefault(),new FormData(w.target).get(i).trim(),n({id:c,text:a}),l(!1)}if(s)return o.jsx(V,{onSubmit:b,inputName:i,buttonText:u,placeholder:d,defaultValue:f,inputRef:r});function y(){l(!0)}return o.jsxs("li",{children:[o.jsx("input",{type:"checkbox"}),o.jsx("span",{children:a}),o.jsx("button",{onClick:e({id:c,text:a}),children:"Delete"}),o.jsx("button",{onClick:y,children:"Edit"})]})}function V({onSubmit:t,inputName:e,buttonText:n,placeholder:r="",defaultValue:c="",inputRef:a}){function s(l){const i=l.target;i.setCustomValidity(""),!i.validity.valid&&i.validity.patternMismatch&&i.setCustomValidity("Entry must not be all white spaces, or begin with a white space.")}return o.jsx("form",{onSubmit:t,children:o.jsxs("fieldset",{children:[o.jsx("legend",{children:"Add a to do item"}),o.jsx("label",{htmlFor:e,children:"Text Content"}),o.jsx("input",{type:"text",name:e,placeholder:r,defaultValue:c,required:!0,autoComplete:"off",pattern:"^(\\S+\\s*)+$",ref:a,onInvalid:s,onInput:s}),o.jsx("button",{type:"submit",children:n})]})})}R.createRoot(document.getElementById("root")).render(o.jsx(m.StrictMode,{children:o.jsx(X,{})}));
